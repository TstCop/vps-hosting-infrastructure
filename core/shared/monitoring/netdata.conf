# Netdata Configuration for VPS Infrastructure
# Optimized for production monitoring

[global]
    hostname = __HOSTNAME__
    history = 3600
    update every = 1
    memory mode = save
    page cache size = 32
    dbengine enabled = yes
    dbengine multihost disk space = 512

[web]
    mode = static-threaded
    listen backlog = 4096
    default port = 19999
    bind socket to IP = 127.0.0.1
    disconnect idle clients after seconds = 60
    timeout for first request = 60
    accept a streaming request every seconds = 2
    respect do not track policy = no
    x-frame-options response header =
    allow connections from = localhost 127.0.0.1 10.0.0.*
    allow dashboard from = localhost 127.0.0.1 10.0.0.*
    allow badges from = *
    allow streaming from = 10.0.0.*
    allow netdata.conf from = localhost 127.0.0.1 10.0.0.*
    allow management from = localhost 127.0.0.1 10.0.0.*

[plugins]
    proc = yes
    diskspace = yes
    cgroups = yes
    tc = no
    idlejitter = yes
    enable running new plugins = yes
    check for new plugins every = 60

    # Python plugins
    python.d = yes

    # Go plugins
    go.d = yes

    # Node.js plugins
    node.d = no

    # Charts.d plugins
    charts.d = no

[plugin:proc]
    /proc/net/dev = yes
    /proc/diskstats = yes
    /proc/mdstat = yes
    /proc/net/snmp = yes
    /proc/net/snmp6 = yes
    /proc/net/netstat = yes
    /proc/net/stat/conntrack = yes
    /proc/net/ip_vs/stats = yes
    /proc/stat = yes
    /proc/meminfo = yes
    /proc/vmstat = yes
    /proc/net/rpc/nfsd = no
    /proc/sys/kernel/random/entropy_avail = yes
    /proc/interrupts = yes
    /proc/softirqs = yes
    /proc/loadavg = yes
    /proc/uptime = yes

[plugin:proc:/proc/net/dev]
    # Network interface monitoring
    filename to monitor = /proc/net/dev
    path to get virtual interfaces = /sys/devices/virtual/net/%s
    path to get net device speed = /sys/class/net/%s/speed
    refresh network interfaces every seconds = 1
    bandwidth for all interfaces = auto
    packets for all interfaces = auto
    errors for all interfaces = auto
    drops for all interfaces = auto
    fifo for all interfaces = auto
    compressed packets for all interfaces = auto
    frames for all interfaces = auto
    multicast packets for all interfaces = auto

[plugin:proc:/proc/diskstats]
    # Disk monitoring
    filename to monitor = /proc/diskstats
    performance metrics for physical disks = auto
    performance metrics for virtual disks = auto
    performance metrics for partitions = no
    bandwidth for all disks = auto
    operations for all disks = auto
    merged operations for all disks = auto
    i/o time for all disks = auto
    queued operations for all disks = auto
    utilization percentage for all disks = auto
    backlog for all disks = auto

[plugin:tc]
    # Traffic control disabled for VPS
    enabled = no

[plugin:diskspace]
    # Disk space monitoring
    update every = 1
    check for new mount points every = 15
    exclude space metrics on paths = /proc/* /sys/* /var/run/user/* /run/user/* /snap/* /var/lib/docker/*
    exclude space metrics on filesystems = *gvfs *fuse.gvfs-fuse-daemon *fuse.lxcfs *fuse.sshfs *tmpfs

[plugin:cgroups]
    # Container monitoring
    update every = 1
    check for new cgroups every = 10
    enable cpuacct stat = yes
    enable cpuacct usage = no
    enable memory = yes
    enable detailed memory = yes
    enable memory limits fail count = yes
    enable swap memory = yes
    enable blkio bandwidth = yes
    enable blkio operations = yes
    enable blkio throttle bandwidth = yes
    enable blkio throttle operations = yes
    enable blkio queued operations = yes
    enable blkio merged operations = yes

# Health monitoring thresholds
[health]
    enabled = yes
    in memory max health log entries = 1000
    script to execute on alarm = /opt/netdata-alarm.sh

    # Notification methods
    default recipient = admin

[alarms]
    # CPU usage alarm
    cpu_usage = yes

    # Memory usage alarm
    ram_usage = yes

    # Disk space alarm
    disk_space_usage = yes

    # Load average alarm
    load_average = yes

    # Network interface errors
    network_interface_errors = yes

# Backend configuration for centralized metrics (optional)
[backend]
    enabled = no
    type = graphite
    destination = 10.0.0.10:2003
    data source = average
    prefix = netdata
    hostname = __HOSTNAME__
    update every = 10
    buffer on failures = 10
    timeout ms = 20000
    send charts matching = *
    send hosts matching = localhost *
    send names instead of ids = yes

# Stream configuration for master-slave setup
[stream]
    enabled = no
    destination = 10.0.0.10:19999
    api key = __API_KEY__
    timeout seconds = 60
    default port = 19999
    multiple connections = yes
    reconnect delay seconds = 5
    initial clock resync iterations = 60

# Application-specific monitoring
[plugin:python.d]
    # Python applications monitoring
    update every = 1
    command options =

[plugin:python.d:nginx]
    # Nginx monitoring
    update_every = 1
    priority = 60000
    retries = 60

[plugin:python.d:redis]
    # Redis monitoring
    update_every = 1
    priority = 60000
    retries = 60

[plugin:python.d:postgres]
    # PostgreSQL monitoring
    update_every = 1
    priority = 60000
    retries = 60

# Custom charts configuration
[plugin:apps]
    # Application monitoring
    update every = 1
    command = apps.plugin

    # Groups configuration
    apps groups = /etc/netdata/apps_groups.conf

[plugin:go.d]
    # Go-based collectors
    update_every = 1

[plugin:go.d:docker_engine]
    # Docker monitoring
    update_every = 1
    autodetection_retry = 0

[plugin:go.d:prometheus]
    # Prometheus metrics collection
    update_every = 1
    autodetection_retry = 0
